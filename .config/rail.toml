# cargo-rail configuration
# Documentation: https://github.com/loadingalias/cargo-rail

# Targets for multi-platform validation (runs `cargo metadata --filter-platform <target>` per target)
targets = [
  # Tier 1 (Guaranteed)
  "aarch64-apple-darwin",
  "aarch64-unknown-linux-gnu",
  "x86_64-apple-darwin",
  "x86_64-pc-windows-msvc",
  "x86_64-unknown-linux-gnu",
  # Tier 2 (Common)
  "aarch64-unknown-linux-musl",
  "wasm32-unknown-unknown",
  "wasm32-wasip1",
  "wasm64-unknown-unknown",
  "x86_64-unknown-linux-musl",
  # Other
  "aarch64-pc-windows-msvc",
  "aarch64-unknown-none",
  "loongarch64-unknown-linux-gnu",
  "powerpc64le-unknown-linux-gnu",
  "riscv32imac-unknown-none-elf",
  "riscv64gc-unknown-linux-gnu",
  "riscv64gc-unknown-none-elf",
  "s390x-unknown-linux-gnu",
  "thumbv6m-none-eabi",
  "x86_64-unknown-none",
]

[unify]
include_paths = true
include_renamed = true

pin_transitives = false  # enable for hakari/workspace-hack users
transitive_host = "root"  # only used if pin_transitives = true

strict_version_compat = true
exact_pin_handling = "warn"
major_version_conflict = "bump"  # warn = skip, bump = force highest

msrv = true
msrv_source = "workspace"  # deps | workspace | max

detect_unused = true
remove_unused = true  # requires detect_unused = true

prune_dead_features = true
preserve_features = []  # glob patterns to keep from pruning
detect_undeclared_features = true
fix_undeclared_features = true  # requires detect_undeclared_features = true
skip_undeclared_patterns = []

exclude = []
include = []
max_backups = 3
sort_dependencies = true  # Sort deps alphabetically (default: true)
enforce_msrv_inheritance = false  # Ensure members inherit workspace rust-version


[release]
tag_prefix = "v" # Prefix for all tags (used via {prefix} in tag_format)
tag_format = "{crate}-{prefix}{version}" # Variables: {prefix}, {crate}, {version}
require_clean = true
publish_delay = 5
create_github_release = false
sign_tags = true
changelog_path = "CHANGELOG.md"
changelog_relative_to = "workspace" # "crate" or "workspace" (default: crate)
skip_changelog_for = []
require_changelog_entries = false


[change-detection]
  infrastructure = [
    ".github/**",
    "scripts/ci/**",
    "justfile",
    "Cargo.lock",
    "rust-toolchain.toml",
    "deny.toml",
    "rustfmt.toml",
    ".cargo/config.toml",
  ]

  [change-detection.custom]
  benchmarks = ["crates/*/benches/**", "scripts/bench/**"]
  test-scripts = ["scripts/test/**"]
