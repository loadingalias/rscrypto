# cargo-rail configuration for rscrypto
# Documentation: https://github.com/loadingalias/cargo-rail

# Targets
targets = [
  # Tier 1 (Guaranteed)
  "aarch64-apple-darwin",
  "aarch64-unknown-linux-gnu",
  "x86_64-apple-darwin",
  "x86_64-pc-windows-msvc",
  "x86_64-unknown-linux-gnu",
  # Tier 2 (Common)
  "aarch64-unknown-linux-musl",
  "wasm32-unknown-unknown",
  "wasm32-wasip1",
  "wasm64-unknown-unknown",
  "x86_64-unknown-linux-musl",
  # Other
  "aarch64-pc-windows-msvc",
  "aarch64-unknown-none",
  "loongarch64-unknown-linux-gnu",
  "powerpc64le-unknown-linux-gnu",
  "riscv32imac-unknown-none-elf",
  "riscv64gc-unknown-linux-gnu",
  "riscv64gc-unknown-none-elf",
  "s390x-unknown-linux-gnu",
  "thumbv6m-none-eabi",
  "x86_64-unknown-none",
]

[unify]
include_paths = true
include_renamed = true

pin_transitives = false
transitive_host = "root"

strict_version_compat = true
exact_pin_handling = "warn"
major_version_conflict = "bump"

msrv = true
msrv_source = "workspace"  # deps | workspace | max

detect_unused = true
remove_unused = true

prune_dead_features = true
preserve_features = []

detect_undeclared_features = true
fix_undeclared_features = true
skip_undeclared_patterns = []

exclude = []
include = []
max_backups = 2
sort_dependencies = true
enforce_msrv_inheritance = false


[release]
tag_prefix = "v"
tag_format = "{prefix}{version}"  # Single crate: just v0.1.0
require_clean = true
publish_delay = 5
create_github_release = true
sign_tags = true
changelog_path = "CHANGELOG.md"
changelog_relative_to = "workspace"
skip_changelog_for = []
require_changelog_entries = false


[change-detection]
  infrastructure = [
    ".github/**",
    "scripts/ci/**",
    "justfile",
    "Cargo.lock",
    "rust-toolchain.toml",
    "deny.toml",
    "rustfmt.toml",
    ".cargo/config.toml",
  ]
conservative_unclassified_owner_fallback = true  # Enable build+test fallback for unclassified crate-owned files
confidence_profile = "balanced"  # Planner confidence profile: strict, balanced, fast
bot_pr_confidence_profile = "strict"  # Optional planner profile override for bot-authored PRs

  [change-detection.custom]
  benchmarks = ["crates/*/benches/**", "scripts/bench/**"]
  test-scripts = ["scripts/test/**"]

[run]
default_profile = "local"  # Default run profile (built-ins: local, ci, nightly)
