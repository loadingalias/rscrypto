[workspace]
resolver = "3"
members = [
  "crates/rscrypto",
  "crates/checksum",
  "crates/hashes",
  "crates/platform",
  "crates/traits",
  "crates/backend",
  "crates/tune",  # Dev-only, excluded from default builds via default-members
]
# Only build core crates by default (faster builds, tune is on-demand)
default-members = [
  "crates/rscrypto",
  "crates/checksum",
  "crates/hashes",
  "crates/platform",
  "crates/traits",
  "crates/backend",
]

[workspace.metadata.docs.rs]
all-features = true
rustdoc-args = ["--cfg", "docsrs"]

[workspace.package]
version = "0.1.0"
edition = "2024"
rust-version = "1.92.0"
license = "MIT OR Apache-2.0"
authors = ["loadingalias"]
repository = "https://github.com/loadingalias/rscrypto"

[workspace.lints.rust]
# `unsafe` is allowed in rscrypto, but must be narrow and well-documented.
unsafe_code = "allow"
unsafe_op_in_unsafe_fn = "deny"
dangling_pointers_from_locals = "deny"
integer_to_ptr_transmutes = "deny"
# Allow miri cfg and x86 target features not yet stabilized in rustc's check-cfg
unexpected_cfgs = { level = "warn", check-cfg = [
  'cfg(miri)',
  'cfg(target_feature, values("movdiri", "movdir64b", "serialize"))',
] }

[workspace.lints.clippy]
correctness = { level = "deny", priority = -1 }
suspicious = { level = "deny", priority = -1 }
perf = { level = "deny", priority = -1 }

std_instead_of_core = "warn"
std_instead_of_alloc = "warn"
unwrap_used = "allow"
expect_used = "allow"
indexing_slicing = "allow"

# Safety discipline:
# - `unsafe {}` blocks must have a `// SAFETY:` comment explaining why theyâ€™re sound.
# - `unsafe fn` must document its safety contract.
undocumented_unsafe_blocks = "deny"
missing_safety_doc = "deny"

[workspace.lints.rustdoc]
broken_intra_doc_links = "deny"
private_intra_doc_links = "warn"

[workspace.dependencies]
criterion = { version = "^0.8.2", default-features = false, features = ["html_reports", "plotters"] } #unified
proptest = "^1.10.0"
platform = { path = "crates/platform", version = "^0.1.0", default-features = false } #unified
backend = { path = "crates/backend", version = "^0.1.0", default-features = false } #unified
traits = { path = "crates/traits", version = "^0.1.0", default-features = false } #unified
checksum = { path = "crates/checksum", version = "^0.1.0", default-features = false } #unified
hashes = { path = "crates/hashes", version = "^0.1.0", default-features = false } #unified
rscrypto = { path = "crates/rscrypto", version = "^0.1.0", default-features = false } #unified

[profile.dev]
opt-level = 0
debug = true
split-debuginfo = "unpacked"
strip = "none"
debug-assertions = true
overflow-checks = true
lto = false
incremental = false # Higher sccache hit rates and faster build/check/test cycles
codegen-units = 256

[profile.release]
opt-level = 3
debug = false
strip = "debuginfo" # Keep symbols for backtraces, remove debug info
overflow-checks = true # Critical for crypto: overflow = security vulnerability
lto = "fat"
panic = "abort"
codegen-units = 1

[profile.bench]
inherits = "release"
debug = true # Enable debug symbols for profiling and analysis
