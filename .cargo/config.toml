# rscrypto Cargo Configuration
# ============================================================
#
# Performance Philosophy:
# - Production: Runtime SIMD detection for portable binaries
# - Benchmarks: Use target-cpu=native for compile-time dispatch
# - Miri/Testing: Portable code via #[cfg(miri)] guards
#
# For maximum performance benchmarks, run with:
#   RUSTFLAGS='-C target-cpu=native' cargo bench
#   OR: just bench-native
#
# ============================================================
# Tier A - Primary Production Targets (Full SIMD)
# ============================================================

# Linux x86_64 - Runtime SIMD detection via std::arch
[target.x86_64-unknown-linux-gnu]

# Linux ARM64 - LSE atomics for better concurrent performance
# All modern ARM64 servers support ARMv8.1+ LSE instructions
[target.aarch64-unknown-linux-gnu]
rustflags = ["-C", "target-feature=+lse"]

# Windows MSVC x86_64 - Runtime SIMD detection via std::arch
[target.x86_64-pc-windows-msvc]

# macOS Apple Silicon - LSE atomics (all M-series support ARMv8.3+)
[target.aarch64-apple-darwin]
rustflags = ["-C", "target-feature=+lse"]

# macOS Intel - Runtime SIMD detection
[target.x86_64-apple-darwin]

# ============================================================
# Tier B - Secondary Production Targets (Partial SIMD)
# ============================================================

# Linux x86_64 MUSL - Static linking for containers
[target.x86_64-unknown-linux-musl]

# Linux ARM64 MUSL - Static linking + LSE atomics
[target.aarch64-unknown-linux-musl]
rustflags = ["-C", "target-feature=+lse"]

# Windows ARM64 - LSE atomics
[target.aarch64-pc-windows-msvc]
rustflags = ["-C", "target-feature=+lse"]

# ============================================================
# Tier C - no_std Targets (Portable fallback only)
# ============================================================

# WASM - Browser/Edge (table-based fallbacks)
[target.wasm32-unknown-unknown]

# WASM - WASI (server-side WASM)
[target.wasm32-wasip1]

# Embedded - Cortex-M0/M0+ (no_std, portable only)
[target.thumbv6m-none-eabi]

# RISC-V 32-bit (no_std, atomics via 'a' extension)
[target.riscv32imac-unknown-none-elf]

# ARM64 bare metal (bootloaders, hypervisors, secure enclaves)
[target.aarch64-unknown-none]

# x86_64 bare metal (kernels, bootloaders, hypervisors)
[target.x86_64-unknown-none]

# RISC-V 64-bit (no_std)
[target.riscv64gc-unknown-none-elf]

# IBM s390x
[target.s390x-unknown-linux-gnu]

# PowerPC64
[target.powerpc64le-unknown-linux-gnu]

# ============================================================
# Build Configuration
# ============================================================

[build]
rustdocflags = ["-D", "warnings"]

[env]
RUST_LOG = "info"
